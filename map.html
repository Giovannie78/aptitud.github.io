<div class="row">
    <div class="col-sm-offset-1 col-sm-10 col-md-offset-3 col-md-6">
        <div class="text-center">
            <img id="map-image" src="images/karta.png" />
        </div>
    </div>
</div>

<div class="row text-center">
	<button type="button" class="btn btn-link top-buffer" id="driveLink">Vill du köra hit?</button>
	<div id="map" class="map top-buffer"></div>
	<button type="button" class="btn btn-link top-buffer bottom-buffer" id="directionsLink" style="display:none">Steg-för-steg-instruktioner?</button>
	<div id="driving-directions" class="top-buffer bottom-buffer" style="display:none"></div>
</div>

<script>
    setBackgroundColor("#FEBE10");

    if (navigator.geolocation) {

	    $("#driveLink").click(function() {
	    	createDrivingDirectionsMap();
	    })

	    $("#directionsLink").click(function() {
	    	$("#driving-directions").show("slow", function() {
        		$("html, body").animate({ scrollTop: $(document).height() }, "slow");
	    	});
	    })

	    var createDrivingDirectionsMap = function() {
	    	navigator.geolocation.getCurrentPosition(onSuccess, onError, {
	    		enableHighAccuracy: true,
	    		maximumAge: 5000,
	    		timeout: 10000
	    	});
	    };

	    function onSuccess(position) {
	    	showMap(position.coords.latitude, position.coords.longitude);
	    };

	    function onError(error) {
	    	switch (error.code) {
	    		case error.PERMISSION_DENIED:
	    			$('#map').html("Du måste godkänna att vi får kolla din position... <a href='http://www.youtube.com/watch?v=JYCZs0m5rrU' target='_blank'>Det här var ju tråkigt...</a>");
	    			break;
	    		case error.POSITION_UNAVAILABLE:
	    			$('#map').html("Tyvärr kan vi kan inte hitta din position... <a href='http://www.youtube.com/watch?v=JYCZs0m5rrU' target='_blank'>Det här var ju tråkigt...</a>");
	    			break;
	    		case error.TIMEOUT:
	    			$('#map').html("Tyvärr tog det för lång tid att hitta din position... <a href='http://www.youtube.com/watch?v=JYCZs0m5rrU' target='_blank'>Det här var ju tråkigt...</a>");
	    			break;
	    		case error.UNKNOWN_ERROR:
	    			$('#map').html("Ånej, något gick fel... <a href='http://www.youtube.com/watch?v=JYCZs0m5rrU' target='_blank'>Det här var ju tråkigt...</a>");
	    			break;
	    	}
	    };

	    function showMap(lat, long) {
	    	var directionsService = new google.maps.DirectionsService();
	    	var directionsRenderer = new google.maps.DirectionsRenderer();

	    	var route = {
	    		origin: new google.maps.LatLng(lat, long),
	    		destination: "Stora Nygatan 7, Stockholm",
	    		travelMode: google.maps.DirectionsTravelMode.DRIVING
	    	};

	    	var mapsOptions = {
	    		zoom: 10,
	    		center: new google.maps.LatLng(59.325107, 18.06803),
	    		mapTypeId: google.maps.MapTypeId.ROADMAP
	    	};

	    	$("#map").addClass('showing');
    		$("#map").height($(window).height()*0.65);
	    	var map = new google.maps.Map(document.getElementById('map'), mapsOptions);
	    	directionsRenderer.setMap(map);
	    	directionsRenderer.setPanel(document.getElementById('driving-directions'));
	    	directionsService.route(route, function(result, status) {
	    		if (status === google.maps.DirectionsStatus.OK) {
            		$("#driveLink").hide("slow");
            		$("html, body").animate({ scrollTop: $(document).height() }, "slow");
	    			directionsRenderer.setDirections(result);
            		$("#directionsLink").show("slow");
	    		}
	    	});
	    }

    } else {
    	$("#driveLink").hide();
    }

</script>